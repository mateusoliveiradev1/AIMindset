<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Artigos - AIMindset</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .article { border: 1px solid #ccc; margin: 10px 0; padding: 15px; }
        .error { color: red; font-weight: bold; }
        .success { color: green; font-weight: bold; }
        .warning { color: orange; font-weight: bold; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>üîç Debug Artigos - AIMindset</h1>
    
    <div>
        <button onclick="testarConexao()">1. Testar Conex√£o Supabase</button>
        <button onclick="listarTodosArtigos()">2. Listar Todos os Artigos</button>
        <button onclick="verificarSEO()">3. Verificar SEO</button>
        <button onclick="testarCarregamento()">4. Testar Carregamento Individual</button>
        <button onclick="corrigirProblemas()" style="background: #ff6b35; color: white;">üîß Corrigir Problemas</button>
        <button onclick="limparResultados()">Limpar</button>
    </div>
    
    <div id="resultados"></div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Configura√ß√£o do Supabase
        const supabaseUrl = 'https://jywjqzhqynhnhetidzsa.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp5d2pxemhxeW5obmhldGlkenNhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA5MjkxMzQsImV4cCI6MjA3NjUwNTEzNH0.oTZ6B-77NGBSqa_lN2YWCtnKwKc0glWnwfuN9xQjDl0';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
        
        function adicionarResultado(tipo, titulo, conteudo) {
            const div = document.createElement('div');
            div.className = tipo;
            div.innerHTML = `<h3>${titulo}</h3><pre>${conteudo}</pre>`;
            document.getElementById('resultados').appendChild(div);
        }
        
        function limparResultados() {
            document.getElementById('resultados').innerHTML = '';
        }
        
        async function testarConexao() {
            adicionarResultado('info', 'üîó Testando Conex√£o', 'Verificando conex√£o com Supabase...');
            
            try {
                const { data, error } = await supabase.from('articles').select('count').limit(1);
                
                if (error) {
                    adicionarResultado('error', '‚ùå ERRO DE CONEX√ÉO', 
                        `C√≥digo: ${error.code}\nMensagem: ${error.message}`);
                } else {
                    adicionarResultado('success', '‚úÖ CONEX√ÉO OK!', 
                        'Supabase conectado com sucesso!');
                }
            } catch (err) {
                adicionarResultado('error', 'üí• ERRO CR√çTICO', err.message);
            }
        }
        
        async function listarTodosArtigos() {
            adicionarResultado('info', 'üìÑ Listando Artigos', 'Buscando todos os artigos...');
            
            try {
                const { data: articles, error } = await supabase
                    .from('articles')
                    .select('id, title, slug, published, excerpt, content, tags, image_url, created_at')
                    .order('created_at', { ascending: false });
                
                if (error) {
                    adicionarResultado('error', '‚ùå ERRO AO BUSCAR ARTIGOS', 
                        `C√≥digo: ${error.code}\nMensagem: ${error.message}`);
                    return;
                }
                
                if (!articles || articles.length === 0) {
                    adicionarResultado('warning', '‚ö†Ô∏è NENHUM ARTIGO ENCONTRADO', 
                        'N√£o h√° artigos na base de dados.');
                    return;
                }
                
                let resultado = `Total de artigos: ${articles.length}\n\n`;
                
                articles.forEach((article, index) => {
                    const problemas = [];
                    
                    // Verificar problemas
                    if (!article.title || article.title.trim() === '') {
                        problemas.push('‚ùå T√çTULO VAZIO');
                    }
                    if (!article.slug || article.slug.trim() === '') {
                        problemas.push('‚ùå SLUG VAZIO');
                    }
                    if (!article.content || article.content.trim() === '') {
                        problemas.push('‚ùå CONTE√öDO VAZIO');
                    }
                    if (!article.published) {
                        problemas.push('‚ö†Ô∏è N√ÉO PUBLICADO');
                    }
                    
                    resultado += `${index + 1}. ${article.title || 'SEM T√çTULO'}\n`;
                    resultado += `   Slug: ${article.slug || 'SEM SLUG'}\n`;
                    resultado += `   Publicado: ${article.published ? 'Sim' : 'N√£o'}\n`;
                    resultado += `   Excerpt: ${article.excerpt ? 'Sim' : 'N√£o'}\n`;
                    resultado += `   Conte√∫do: ${article.content ? 'Sim' : 'N√£o'}\n`;
                    resultado += `   Tags: ${article.tags || 'Nenhuma'}\n`;
                    resultado += `   Imagem: ${article.image_url ? 'Sim' : 'N√£o'}\n`;
                    
                    if (problemas.length > 0) {
                        resultado += `   PROBLEMAS: ${problemas.join(', ')}\n`;
                    } else {
                        resultado += `   ‚úÖ OK\n`;
                    }
                    resultado += `\n`;
                });
                
                adicionarResultado('success', '‚úÖ ARTIGOS LISTADOS', resultado);
                
            } catch (err) {
                adicionarResultado('error', 'üí• ERRO AO LISTAR', err.message);
            }
        }
        
        async function verificarSEO() {
            adicionarResultado('info', 'üîç Verificando SEO', 'Analisando metadados SEO...');
            
            try {
                const { data: seoData, error } = await supabase
                    .from('seo_metadata')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (error) {
                    adicionarResultado('error', '‚ùå ERRO AO BUSCAR SEO', 
                        `C√≥digo: ${error.code}\nMensagem: ${error.message}`);
                    return;
                }
                
                if (!seoData || seoData.length === 0) {
                    adicionarResultado('warning', '‚ö†Ô∏è NENHUM SEO ENCONTRADO', 
                        'N√£o h√° metadados SEO na base.');
                    return;
                }
                
                let resultado = `Total de registros SEO: ${seoData.length}\n\n`;
                
                seoData.forEach((seo, index) => {
                    const problemas = [];
                    
                    if (!seo.title || seo.title.includes('Artigo sobre IA')) {
                        problemas.push('‚ùå T√çTULO GEN√âRICO');
                    }
                    if (!seo.description || seo.description.length < 50) {
                        problemas.push('‚ùå DESCRI√á√ÉO RUIM');
                    }
                    if (!seo.keywords || seo.keywords.length < 3) {
                        problemas.push('‚ùå POUCAS KEYWORDS');
                    }
                    
                    resultado += `${index + 1}. ${seo.page_type}/${seo.page_slug || 'home'}\n`;
                    resultado += `   T√≠tulo: ${seo.title}\n`;
                    resultado += `   Descri√ß√£o: ${seo.description}\n`;
                    resultado += `   Keywords: ${Array.isArray(seo.keywords) ? seo.keywords.join(', ') : seo.keywords}\n`;
                    
                    if (problemas.length > 0) {
                        resultado += `   PROBLEMAS: ${problemas.join(', ')}\n`;
                    } else {
                        resultado += `   ‚úÖ SEO OK\n`;
                    }
                    resultado += `\n`;
                });
                
                adicionarResultado('success', '‚úÖ SEO ANALISADO', resultado);
                
            } catch (err) {
                adicionarResultado('error', 'üí• ERRO AO VERIFICAR SEO', err.message);
            }
        }
        
        async function testarCarregamento() {
            adicionarResultado('info', 'üß™ Testando Carregamento', 'Testando carregamento individual...');
            
            try {
                // Buscar artigos publicados
                const { data: articles, error } = await supabase
                    .from('articles')
                    .select('slug, title')
                    .eq('published', true);
                
                if (error) {
                    adicionarResultado('error', '‚ùå ERRO AO BUSCAR ARTIGOS', error.message);
                    return;
                }
                
                if (!articles || articles.length === 0) {
                    adicionarResultado('warning', '‚ö†Ô∏è NENHUM ARTIGO PUBLICADO', 
                        'N√£o h√° artigos publicados para testar.');
                    return;
                }
                
                let resultado = `Testando ${articles.length} artigos:\n\n`;
                
                for (const article of articles) {
                    try {
                        // Testar carregamento individual
                        const { data: fullArticle, error: loadError } = await supabase
                            .from('articles')
                            .select('*')
                            .eq('slug', article.slug)
                            .eq('published', true)
                            .single();
                        
                        if (loadError) {
                            resultado += `‚ùå ${article.title}: ERRO - ${loadError.message}\n`;
                        } else if (!fullArticle) {
                            resultado += `‚ùå ${article.title}: N√ÉO ENCONTRADO\n`;
                        } else {
                            resultado += `‚úÖ ${article.title}: OK\n`;
                            
                            // Testar URL do artigo
                            const articleUrl = `http://localhost:5174/artigo/${article.slug}`;
                            resultado += `   URL: ${articleUrl}\n`;
                        }
                    } catch (err) {
                        resultado += `üí• ${article.title}: ERRO CR√çTICO - ${err.message}\n`;
                    }
                }
                
                adicionarResultado('success', '‚úÖ TESTE CONCLU√çDO', resultado);
                
            } catch (err) {
                adicionarResultado('error', 'üí• ERRO NO TESTE', err.message);
            }
        }
        
        async function corrigirProblemas() {
            adicionarResultado('info', 'üîß Corrigindo Problemas', 'Iniciando corre√ß√µes autom√°ticas...');
            
            try {
                // 1. Buscar artigos com problemas
                const { data: articles, error } = await supabase
                    .from('articles')
                    .select('*');
                
                if (error) {
                    adicionarResultado('error', '‚ùå ERRO AO BUSCAR ARTIGOS', error.message);
                    return;
                }
                
                let resultado = 'Corre√ß√µes realizadas:\n\n';
                let correcoes = 0;
                
                for (const article of articles) {
                    const updates = {};
                    let needsUpdate = false;
                    
                    // Corrigir t√≠tulo vazio ou gen√©rico
                    if (!article.title || article.title.trim() === '' || article.title === 'artigo') {
                        updates.title = `Artigo ${article.id.substring(0, 8)} - Conte√∫do sobre IA`;
                        needsUpdate = true;
                        resultado += `‚úÖ T√≠tulo corrigido: ${updates.title}\n`;
                    }
                    
                    // Corrigir slug vazio
                    if (!article.slug || article.slug.trim() === '') {
                        updates.slug = `artigo-${article.id.substring(0, 8)}`;
                        needsUpdate = true;
                        resultado += `‚úÖ Slug corrigido: ${updates.slug}\n`;
                    }
                    
                    // Corrigir excerpt vazio
                    if (!article.excerpt || article.excerpt.trim() === '') {
                        updates.excerpt = 'Descubra insights valiosos sobre intelig√™ncia artificial e como ela pode transformar sua produtividade.';
                        needsUpdate = true;
                        resultado += `‚úÖ Excerpt corrigido\n`;
                    }
                    
                    // Corrigir conte√∫do vazio
                    if (!article.content || article.content.trim() === '') {
                        updates.content = '<h2>Conte√∫do em Desenvolvimento</h2><p>Este artigo est√° sendo desenvolvido com conte√∫do sobre intelig√™ncia artificial e produtividade.</p>';
                        needsUpdate = true;
                        resultado += `‚úÖ Conte√∫do b√°sico adicionado\n`;
                    }
                    
                    // Aplicar corre√ß√µes
                    if (needsUpdate) {
                        const { error: updateError } = await supabase
                            .from('articles')
                            .update(updates)
                            .eq('id', article.id);
                        
                        if (updateError) {
                            resultado += `‚ùå Erro ao atualizar ${article.id}: ${updateError.message}\n`;
                        } else {
                            correcoes++;
                            resultado += `‚úÖ Artigo ${article.id.substring(0, 8)} atualizado\n`;
                        }
                    }
                }
                
                resultado += `\nTotal de corre√ß√µes: ${correcoes}`;
                adicionarResultado('success', '‚úÖ CORRE√á√ïES CONCLU√çDAS', resultado);
                
            } catch (err) {
                adicionarResultado('error', 'üí• ERRO NAS CORRE√á√ïES', err.message);
            }
        }
        
        // Executar teste inicial
        window.onload = function() {
            adicionarResultado('info', 'üöÄ Debug Iniciado', 'Sistema de debug carregado. Clique nos bot√µes para executar os testes.');
        };
    </script>
</body>
</html>